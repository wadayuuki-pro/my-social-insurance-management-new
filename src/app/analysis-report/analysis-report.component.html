<div class="analysis-dashboard-container">
  <h2>åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸</h2>

  <!-- ã‚¿ãƒ–UI -->
  <div class="tab-header">
    <button [class.active]="selectedTab === 'summary'" (click)="selectTab('summary')">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚µãƒãƒªãƒ¼</button>
    <button [class.active]="selectedTab === 'line'" (click)="selectTab('line')">ğŸ“ˆ æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•</button>
    <button [class.active]="selectedTab === 'barpie'" (click)="selectTab('barpie')">ğŸ“Š æ£’ã‚°ãƒ©ãƒ•ãƒ»å††ã‚°ãƒ©ãƒ•</button>
  </div>

  <!-- ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚µãƒãƒªãƒ¼ -->
  <div *ngIf="selectedTab === 'summary'">
    <div style="margin-bottom: 1.2rem; display: flex; gap: 1.5rem; align-items: center;">
      <div>
        <label style="font-weight: bold; color: #1976d2; margin-right: 1em;">äº‹æ¥­æ‰€é¸æŠï¼š</label>
        <select [(ngModel)]="selectedDepartmentId" (ngModelChange)="onDepartmentChange($event)" style="padding: 0.5em 1em; border-radius: 6px; border: 1px solid #e3eaf3; min-width: 180px;">
          <option *ngFor="let dept of departmentList" [value]="dept.department_id">{{ dept.department_id }}ï¼ˆ{{ dept.department_name }}ï¼‰</option>
        </select>
      </div>
      <div>
        <label style="font-weight: bold; color: #1976d2; margin-right: 1em;">å¯¾è±¡å¹´æœˆï¼š</label>
        <select [(ngModel)]="selectedYearMonth" (ngModelChange)="onYearMonthChange($event)" style="padding: 0.5em 1em; border-radius: 6px; border: 1px solid #e3eaf3; min-width: 180px;">
          <option *ngFor="let ym of yearMonthOptions" [value]="ym">{{ ym }}</option>
        </select>
      </div>
    </div>
    <div class="summary-cards">
      <div class="summary-card">
        <div class="summary-title">å¾“æ¥­å“¡ç·æ•°</div>
        <div class="summary-value">{{ employeeCount }}å</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">åœ¨ç±æ•°</div>
        <div class="summary-value">{{ activeCount }}å</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">é€€è·æ•°</div>
        <div class="summary-value">{{ retiredCount }}å</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">ä¿é™ºæ–™ç·é¡</div>
        <div class="summary-value">Â¥{{ insuranceTotal | number }} </div>
        <div class="summary-sub">å¥åº·ä¿é™ºãƒ»åšç”Ÿå¹´é‡‘ãƒ»ä»‹è­·ä¿é™º</div>
      </div>
    </div>
    <!-- â–¼è² æ‹…æ¯”ç‡ã‚«ãƒ¼ãƒ‰ï¼ˆä¿é™ºæ–™ç®¡ç†ãƒšãƒ¼ã‚¸ã®UIã‚’å‚è€ƒã«è¿½åŠ ï¼‰ -->
    <div style="display: flex; gap: 1.5rem; justify-content: center; margin: 2.5rem 0 1.5rem 0; flex-wrap: wrap;">
      <div style="background: #e3f2fd; color: #1976d2; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">ä¼šç¤¾è² æ‹…åˆè¨ˆ</div>
        <div style="font-size: 2em; font-weight: bold;">Â¥{{ totalCompanyBurden | number }}</div>
        <div style="font-size: 1em; color: #1976d2; margin-top: 0.5em;">è² æ‹…ç‡ {{ companyBurdenRatio }}%</div>
      </div>
      <div style="background: #fff3e0; color: #fb8c00; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(251, 140, 0, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">å¾“æ¥­å“¡è² æ‹…åˆè¨ˆ</div>
        <div style="font-size: 2em; font-weight: bold;">Â¥{{ totalEmployeeBurden | number }}</div>
        <div style="font-size: 1em; color: #fb8c00; margin-top: 0.5em;">è² æ‹…ç‡ {{ employeeBurdenRatio }}%</div>
      </div>
      <div style="background: #e8f5e9; color: #388e3c; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(56, 142, 60, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">ç·åˆè¨ˆ</div>
        <div style="font-size: 2em; font-weight: bold;">Â¥{{ totalBurden | number }}</div>
      </div>
    </div>
    <!-- â–²è² æ‹…æ¯”ç‡ã‚«ãƒ¼ãƒ‰ã“ã“ã¾ã§ -->

    <!-- â–¼ä¿é™ºæ–™è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div style="margin-top: 2rem;">
      <h3 style="color: #1976d2; font-size: 1.2rem; margin-bottom: 1rem;">ä¿é™ºæ–™è©³ç´°</h3>
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: separate; border-spacing: 0; white-space: nowrap;">
          <thead>
            <tr>
              <th style="background: #e3f2fd; color: #1976d2; padding: 1rem; text-align: left; border-bottom: 2px solid #bbdefb;">ä¿é™ºæ–™ç¨®åˆ¥</th>
              <th style="background: #e3f2fd; color: #1976d2; padding: 1rem; text-align: right; border-bottom: 2px solid #bbdefb;">ä¼šç¤¾è² æ‹…</th>
              <th style="background: #e3f2fd; color: #1976d2; padding: 1rem; text-align: right; border-bottom: 2px solid #bbdefb;">å¾“æ¥­å“¡è² æ‹…</th>
              <th style="background: #e3f2fd; color: #1976d2; padding: 1rem; text-align: right; border-bottom: 2px solid #bbdefb;">åˆè¨ˆ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 1rem; border-bottom: 1px solid #e0e0e0;">å¥åº·ä¿é™ºæ–™ï¼ˆä»‹è­·ä¿é™ºè¾¼ã¿ï¼‰</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ ippanCompanyTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ ippanEmployeeTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ ippanCompanyTotal + ippanEmployeeTotal | number }}</td>
            </tr>
            <tr>
              <td style="padding: 1rem; border-bottom: 1px solid #e0e0e0;">ä»‹è­·ä¿é™ºæ–™</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kaigoCompanyTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kaigoEmployeeTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kaigoCompanyTotal + kaigoEmployeeTotal | number }}</td>
            </tr>
            <tr>
              <td style="padding: 1rem; border-bottom: 1px solid #e0e0e0;">åšç”Ÿå¹´é‡‘ä¿é™ºæ–™</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kouseiCompanyTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kouseiEmployeeTotal | number }}</td>
              <td style="padding: 1rem; text-align: right; border-bottom: 1px solid #e0e0e0;">Â¥{{ kouseiCompanyTotal + kouseiEmployeeTotal | number }}</td>
            </tr>
            <tr style="background: #f8f9fa;">
              <td style="padding: 1rem; font-weight: bold;">åˆè¨ˆ</td>
              <td style="padding: 1rem; text-align: right; font-weight: bold;">Â¥{{ totalCompanyBurden | number }}</td>
              <td style="padding: 1rem; text-align: right; font-weight: bold;">Â¥{{ totalEmployeeBurden | number }}</td>
              <td style="padding: 1rem; text-align: right; font-weight: bold;">Â¥{{ totalBurden | number }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- â–²ä¿é™ºæ–™è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã“ã“ã¾ã§ -->
  </div>

  <!-- ğŸ“ˆ æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• -->
  <div *ngIf="selectedTab === 'line'">
    <div style="margin-bottom: 1.2rem;">
      <label style="font-weight: bold; color: #1976d2; margin-right: 1em;">äº‹æ¥­æ‰€é¸æŠï¼š</label>
      <select [(ngModel)]="selectedDepartmentId" (ngModelChange)="onDepartmentChange($event)" style="padding: 0.5em 1em; border-radius: 6px; border: 1px solid #e3eaf3; min-width: 180px;">
        <option *ngFor="let dept of departmentList" [value]="dept.department_id">{{ dept.department_id }}ï¼ˆ{{ dept.department_name }}ï¼‰</option>
      </select>
    </div>
    <div class="graph-section">
      <h3>æœˆåˆ¥åŠ å…¥è€…æ•°æ¨ç§»</h3>
      <canvas id="lineChart1" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>æœˆåˆ¥å–ªå¤±è€…æ•°æ¨ç§»</h3>
      <canvas id="lineChart2" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>è³ä¸æ”¯çµ¦ã®æ¨ç§»</h3>
      <canvas id="lineChart3" width="600" height="250"></canvas>
    </div>
  </div>

  <!-- ğŸ“Š æ£’ã‚°ãƒ©ãƒ•ï¼å††ã‚°ãƒ©ãƒ• -->
  <div *ngIf="selectedTab === 'barpie'">
    <div style="margin-bottom: 1.2rem;">
      <label style="font-weight: bold; color: #1976d2; margin-right: 1em;">äº‹æ¥­æ‰€é¸æŠï¼š</label>
      <select [(ngModel)]="selectedDepartmentId" (ngModelChange)="onDepartmentChange($event)" style="padding: 0.5em 1em; border-radius: 6px; border: 1px solid #e3eaf3; min-width: 180px;">
        <option *ngFor="let dept of departmentList" [value]="dept.department_id">{{ dept.department_id }}ï¼ˆ{{ dept.department_name }}ï¼‰</option>
      </select>
    </div>
    <div class="graph-section">
      <h3>æ‹ ç‚¹åˆ¥ä¿é™ºæ–™ç·é¡æ¯”è¼ƒ</h3>
      <canvas id="barChart1" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>å¾“æ¥­å“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥äººæ•°</h3>
      <canvas id="barChart2" width="600" height="250"></canvas>
    </div>
  </div>

  <div class="dashboard-user-info" style="position: absolute; top: 1.2rem; right: 2.5rem; background: #e3f2fd; color: #1976d2; border-radius: 8px; padding: 0.7rem 1.2rem; font-size: 1rem; font-weight: 500; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.08);">
    <ng-container *ngIf="isAuthReady$ | async as isReady">
      <ng-container *ngIf="isReady; else loading">
        <ng-container *ngIf="employeeInfo$ | async as info; else notLoggedIn">
          <span *ngIf="info; else notLoggedIn">
            ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼šä¼šç¤¾ID:{{ info.company_id }}ï¼ç¤¾å“¡ID:{{ info.employee_code }}ï¼æ°å:{{ info.name }}
          </span>
        </ng-container>
        <ng-template #notLoggedIn>
          <ng-container *ngIf="user$ | async as user">
            <span *ngIf="user?.email">ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š{{ user.email }}</span>
            <span *ngIf="!user?.email">ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“</span>
          </ng-container>
        </ng-template>
      </ng-container>
      <ng-template #loading>
        <span>èªè¨¼ç¢ºèªä¸­...</span>
      </ng-template>
    </ng-container>
  </div>
</div> 