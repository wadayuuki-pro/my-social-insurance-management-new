<div class="analysis-dashboard-container">
  <h2>分析・レポートページ</h2>

  <!-- タブUI -->
  <div class="tab-header">
    <button [class.active]="selectedTab === 'summary'" (click)="selectTab('summary')">📊 ダッシュボードサマリー</button>
    <button [class.active]="selectedTab === 'line'" (click)="selectTab('line')">📈 折れ線グラフ</button>
    <button [class.active]="selectedTab === 'barpie'" (click)="selectTab('barpie')">📊 棒グラフ・円グラフ</button>
    <button [class.active]="selectedTab === 'filter'" (click)="selectTab('filter')">📥 データ出力・フィルター</button>
  </div>

  <!-- 📊 ダッシュボードサマリー -->
  <div *ngIf="selectedTab === 'summary'">
    <div style="margin-bottom: 1.2rem;">
      <label style="font-weight: bold; color: #1976d2; margin-right: 1em;">事業所選択：</label>
      <select [(ngModel)]="selectedDepartmentId" (ngModelChange)="onDepartmentChange($event)" style="padding: 0.5em 1em; border-radius: 6px; border: 1px solid #e3eaf3; min-width: 180px;">
        <option *ngFor="let dept of departmentList" [value]="dept.department_id">{{ dept.department_id }}（{{ dept.department_name }}）</option>
      </select>
    </div>
    <div class="summary-cards">
      <div class="summary-card">
        <div class="summary-title">従業員総数</div>
        <div class="summary-value">{{ employeeCount }}名</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">在籍数</div>
        <div class="summary-value">{{ activeCount }}名</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">退職数</div>
        <div class="summary-value">{{ retiredCount }}名</div>
      </div>
      <div class="summary-card">
        <div class="summary-title">保険料総額</div>
        <div class="summary-value">¥{{ insuranceTotal | number }} </div>
        <div class="summary-sub">健康保険・厚生年金・介護保険</div>
      </div>
    </div>
    <!-- ▼負担比率カード（保険料管理ページのUIを参考に追加） -->
    <div style="display: flex; gap: 1.5rem; justify-content: center; margin: 2.5rem 0 1.5rem 0; flex-wrap: wrap;">
      <div style="background: #e3f2fd; color: #1976d2; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">会社負担合計</div>
        <div style="font-size: 2em; font-weight: bold;">¥0</div>
        <div style="font-size: 1em; color: #1976d2; margin-top: 0.5em;">負担率 60%</div>
      </div>
      <div style="background: #fff3e0; color: #fb8c00; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(251, 140, 0, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">従業員負担合計</div>
        <div style="font-size: 2em; font-weight: bold;">¥0</div>
        <div style="font-size: 1em; color: #fb8c00; margin-top: 0.5em;">負担率 40%</div>
      </div>
      <div style="background: #e8f5e9; color: #388e3c; border-radius: 1.2em; padding: 1.2em 2.2em; min-width: 200px; box-shadow: 0 2px 8px rgba(56, 142, 60, 0.08); text-align: center;">
        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">総合計</div>
        <div style="font-size: 2em; font-weight: bold;">¥0</div>
      </div>
    </div>
    <!-- ▲負担比率カードここまで -->
  </div>

  <!-- 📈 折れ線グラフ -->
  <div *ngIf="selectedTab === 'line'">
    <div class="graph-section">
      <h3>月別加入者数推移</h3>
      <canvas id="lineChart1" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>月別喪失者数推移</h3>
      <canvas id="lineChart2" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>月額変更・賞与支給の推移</h3>
      <canvas id="lineChart3" width="600" height="250"></canvas>
    </div>
  </div>

  <!-- 📊 棒グラフ／円グラフ -->
  <div *ngIf="selectedTab === 'barpie'">
    <div class="graph-section">
      <h3>拠点別保険料総額比較</h3>
      <canvas id="barChart1" width="600" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>保険料負担割合（会社・従業員）</h3>
      <canvas id="pieChart1" width="400" height="250"></canvas>
    </div>
    <div class="graph-section">
      <h3>従業員ステータス別人数</h3>
      <canvas id="barChart2" width="600" height="250"></canvas>
    </div>
  </div>

  <!-- 📥 データ出力・フィルター -->
  <div *ngIf="selectedTab === 'filter'">
    <div class="filter-export-row">
      <div class="filter-controls">
        <label>期間指定:
          <input type="month" value="2024-01"> ～ <input type="month" value="2024-06">
        </label>
        <label>拠点:
          <select>
            <option>全拠点</option>
            <option>東京本社</option>
            <option>大阪支社</option>
          </select>
        </label>
      </div>
      <div class="export-controls">
        <button class="export-btn">CSV出力</button>
        <button class="export-btn">PDF出力</button>
      </div>
    </div>
  </div>
</div> 